# Netlify 환경변수 설정 가이드

## 시크릿 스캔 오류 해결

Netlify에서 시크릿 스캔이 감지한 API 키들을 환경변수로 설정하여 보안을 강화했습니다.

## 필요한 환경변수

다음 환경변수들을 Netlify 대시보드에서 설정해주세요:

### 1. Firebase API 키
- **변수명**: `VITE_FIREBASE_API_KEY`
- **값**: `YOUR_FIREBASE_API_KEY_HERE` (실제 키는 Netlify 환경변수에서 설정)
- **사용 파일**: `market_data.html`

### 2. Google Maps API 키
- **변수명**: `VITE_GOOGLE_MAPS_API_KEY`
- **값**: `YOUR_GOOGLE_MAPS_API_KEY_HERE` (실제 키는 Netlify 환경변수에서 설정)
- **사용 파일**: `39_index.html`
- **중요**: 정적 HTML 파일에서 환경변수를 사용하려면 빌드 시점에 주입되어야 합니다.

### 3. DART API 키 (새로 추가)
- **변수명**: `DART_API_KEY`
- **값**: `YOUR_DART_API_KEY_HERE` (실제 키는 Netlify 환경변수에서 설정)
- **사용 파일**: `netlify/functions/dart.js`
- **중요**: 서버사이드에서만 사용되므로 클라이언트에 노출되지 않습니다.

### 4. QUANDL API 키 (경제지표 데이터용)
- **변수명**: `QUANDL_KEY`
- **값**: `taBvxWNCzv4QLVLdxGSf` (실제 키 값)
- **사용 파일**: `netlify/functions/quandl.js`
- **중요**: 경제지표 데이터 조회에 필요하며, 서버사이드에서만 사용됩니다.
- **발급처**: [Nasdaq Data Link (구 Quandl)](https://data.nasdaq.com/)
- **업데이트**: FRED 계열 데이터셋으로 표준화하여 프리미엄/403 오류 회피

## 실제 API 키 값 (개발자용)

⚠️ **주의**: 이 값들은 보안을 위해 별도로 전달됩니다. 이 문서에는 포함하지 않습니다.

- Firebase API 키: 개발자에게 별도 전달
- Google Maps API 키: 개발자에게 별도 전달
- DART API 키: 개발자에게 별도 전달 (OpenDART에서 발급받은 키)
- QUANDL API 키: 개발자에게 별도 전달 (Nasdaq Data Link에서 발급받은 키)

## 설정 방법

1. Netlify 대시보드에 로그인
2. 해당 사이트 선택
3. **Site settings** → **Environment variables** 이동
4. **Add variable** 클릭
5. 위의 변수명과 실제 키 값을 입력
6. **Save** 클릭
7. **중요**: 환경변수 설정 후 반드시 재배포해야 합니다.

## 정적 HTML에서 환경변수 사용 방법

정적 HTML 파일에서는 `${process.env.VARIABLE_NAME}` 형태가 작동하지 않습니다. 대신 다음과 같이 설정해야 합니다:

1. **HTML 파일 상단에 환경변수 설정**:
```html
<script>
  window.env = {
    VITE_GOOGLE_MAPS_API_KEY: 'YOUR_GOOGLE_MAPS_API_KEY_HERE'
  };
</script>
```

2. **JavaScript에서 환경변수 사용**:
```javascript
const API_KEY = window.env?.VITE_GOOGLE_MAPS_API_KEY || 'fallback_key';
```

## 추가 보안 권장사항

1. **API 키 제한 설정**:
   - Firebase API 키: 특정 도메인에서만 사용 가능하도록 제한
   - Google Maps API 키: HTTP 리퍼러 제한 설정

2. **정기적인 키 로테이션**:
   - API 키를 정기적으로 변경하여 보안 강화

3. **모니터링**:
   - API 사용량 모니터링으로 비정상적인 사용 감지

## 문제 해결

만약 환경변수 설정 후에도 문제가 발생한다면:

1. 빌드 로그에서 환경변수가 제대로 로드되었는지 확인
2. 브라우저 개발자 도구에서 `process.env` 값 확인
3. 필요시 Netlify 지원팀에 문의

### QUANDL API 관련 문제 해결

**403 Forbidden 오류가 발생하는 경우:**
1. `QUANDL_KEY` 환경변수가 올바르게 설정되었는지 확인
2. API 키가 유효하고 만료되지 않았는지 확인
3. 데이터셋 접근 권한이 있는지 확인 (일부 데이터셋은 유료 구독 필요)

**"Upstream returned non-JSON" 오류가 발생하는 경우:**
1. API 키가 잘못되어 HTML 로그인 페이지가 반환되는 경우
2. 데이터셋 코드가 올바른지 확인 (예: FRED/DGS10, FRED/FEDFUNDS)
3. 날짜 범위가 유효한지 확인

**일반적인 해결 방법:**
1. Netlify Functions 로그 확인: Netlify 대시보드 > Functions > Logs
2. API 키 재발급 후 환경변수 업데이트
3. 사이트 재배포 후 테스트

## 시크릿 스캔 우회 방법

만약 여전히 시크릿 스캔에서 문제가 발생한다면:

1. Netlify 대시보드에서 **Site settings** → **Build & deploy** → **Environment variables**
2. 다음 환경변수 추가:
   - `SECRETS_SCAN_SMART_DETECTION_ENABLED`: `false`
   - 또는 `SECRETS_SCAN_SMART_DETECTION_OMIT_VALUES`: `AIzaSyDkha1vn85XCUKbsxUSMxLpVepnhf7hCb8,AIzaSyAwXuwl9ZoLcslEpbYUVMqC1NoDZYxZ5Qg`