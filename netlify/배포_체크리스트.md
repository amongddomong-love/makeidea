# 🚀 Netlify 배포 체크리스트

프록시 함수가 올바르게 작동하지 않을 때 순서대로 확인하세요.

## ✅ 1. Netlify 함수 배포 확인

### 📁 파일 구조 확인
```
프로젝트 루트/
├── netlify.toml                    ✅ Functions 디렉토리 설정
├── netlify/functions/
│   └── openai-proxy.js            ✅ 프록시 함수 파일
└── Ailert_view.html               ✅ 클라이언트 코드
```

### 🔧 netlify.toml 설정
```toml
[functions]
  directory = "netlify/functions"    # ✅ 올바른 경로 설정
```

### 🌐 배포 후 확인
1. **Netlify 대시보드** → **사이트 선택** → **Deploys**
2. **Functions** 탭에서 `openai-proxy` 함수 확인
3. **로그**에서 에러 메시지 확인

## ✅ 2. 환경변수 설정 확인

### 🔑 필수 환경변수
| 변수명 | 설명 | 예시 |
|--------|------|------|
| `OPENAI_API_KEY` | OpenAI API 키 (필수) | `sk-proj-...` |
| `OPENAI_BASE_URL` | API 엔드포인트 (선택) | `https://api.openai.com/v1` |
| `ALLOWED_ORIGINS` | CORS 허용 도메인 (선택) | `*` 또는 `https://mysite.com` |

### 📋 설정 방법
1. **Netlify 대시보드** → **Site settings** → **Environment variables**
2. **Add variable** 클릭
3. 변수 추가 후 **반드시 재배포**

## ✅ 3. 로컬 개발 확인

### 💻 로컬 테스트
```bash
# Netlify CLI 설치 (없는 경우)
npm install -g netlify-cli

# 로컬 개발 서버 시작
netlify dev

# 브라우저에서 http://localhost:8888 접속
```

### 🔍 디버깅 도구
개발자 도구 콘솔에서 실행:
```javascript
// 프록시 상태 확인
debugApiKeyStatus()

// 직접 프록시 테스트
fetch('/.netlify/functions/openai-proxy', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    model: 'gpt-4o-mini',
    messages: [{ role: 'user', content: 'test' }],
    max_tokens: 5
  })
}).then(r => r.json()).then(console.log)
```

## ⚠️ 4. 일반적인 문제 해결

### 🔴 404 오류: 함수가 배포되지 않음
**원인**: 
- `netlify.toml`에 Functions 디렉토리 설정 누락
- 함수 파일 경로 오류
- 배포 실패

**해결**:
```toml
# netlify.toml 확인
[functions]
  directory = "netlify/functions"
```

### 🔴 500 오류: 환경변수 미설정
**원인**: `OPENAI_API_KEY` 환경변수 없음

**해결**: 
1. Netlify 대시보드에서 환경변수 설정
2. 재배포 필수

### 🔴 403/401 오류: API 키 문제
**원인**: 
- 잘못된 API 키
- API 키 권한 부족
- API 사용량 초과

**해결**:
1. OpenAI 대시보드에서 API 키 확인
2. 계정 잔액 및 사용량 확인
3. 새 API 키 생성 후 교체

### 🔴 CORS 오류: 도메인 제한
**원인**: `ALLOWED_ORIGINS` 설정 문제

**해결**:
```bash
# 모든 도메인 허용 (개발용)
ALLOWED_ORIGINS=*

# 특정 도메인만 허용 (운영용)
ALLOWED_ORIGINS=https://mysite.netlify.app,https://mydomain.com
```

## 🔧 5. 고급 설정

### 🌍 다른 AI 서비스 사용
```bash
# Groq 사용
OPENAI_BASE_URL=https://api.groq.com/openai/v1
OPENAI_API_KEY=gsk_...

# Together AI 사용
OPENAI_BASE_URL=https://api.together.xyz/v1
OPENAI_API_KEY=...
```

### 🚫 로컬 서버 주의사항
❌ **불가능**: 로컬 LM Studio 등 (http://127.0.0.1:1234)
- Netlify Functions는 클라우드에서 실행
- 로컬 주소에 접근 불가

✅ **가능**: 공인 IP로 노출된 서버
- VPS나 클라우드 서버 사용
- 적절한 CORS 설정 필요

## 📞 지원

문제가 계속되면:
1. **개발자 도구** → **네트워크** 탭에서 요청/응답 확인
2. **Netlify 대시보드** → **Functions** → **로그** 확인
3. `debugApiKeyStatus()` 실행 결과 확인

---

> 💡 **팁**: 환경변수 변경 후 반드시 재배포를 해야 적용됩니다!
