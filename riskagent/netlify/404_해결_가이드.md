# 🚨 chartupndown.com에서 /.netlify/functions/openai-proxy 404 오류 해결 가이드

## 📋 **진단 체크리스트**

### ✅ **체크 0: 도메인이 올바른 Netlify 사이트를 보고 있는지 확인**

1. **브라우저 개발자 도구** → **Network** 탭
2. **chartupndown.com 페이지 새로고침**
3. **응답 헤더 확인**:
   - `server: Netlify` 또는
   - `x-nf-request-id: xxxxx` 또는
   - `x-nf-cache-info: xxxx`

❌ **Netlify 헤더가 없다면**: DNS 설정 문제
- Netlify 대시보드 → Domain settings → DNS 설정 확인
- 커스텀 도메인이 올바른 사이트에 연결되었는지 확인

✅ **Netlify 헤더가 있다면**: 다음 단계 진행

### ✅ **체크 1: Functions 디렉토리 구조 확인**

현재 설정:
```
프로젝트 루트/
├── netlify.toml                    ✅ 수정됨
├── netlify/functions/
│   └── openai-proxy.js            ✅ 존재함
└── Ailert_view.html               ✅ 클라이언트 코드
```

### ✅ **체크 2: netlify.toml 설정 (수정됨)**

```toml
[build]
  publish = "."
  command = "npm run build"
  functions = "netlify/functions"  # ✅ 수정됨

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### ✅ **체크 3: 함수 코드 (진단용 GET 추가됨)**

이제 다음 URL로 함수 상태를 확인할 수 있습니다:
- `https://chartupndown.com/.netlify/functions/openai-proxy` (GET)
- 예상 응답: `{"ok": true, "where": "openai-proxy", ...}`

## 🧪 **테스트 방법**

### **방법 1: 브라우저에서 직접 테스트**

1. **chartupndown.com** 페이지 열기
2. **개발자 도구** → **Console** 탭
3. **다음 명령어 실행**:

```javascript
// 1. 도메인 라우팅 확인
checkDomainRouting()

// 2. 프록시 함수 직접 테스트
testOpenAIProxy()

// 3. 프록시 상태 확인
debugApiKeyStatus()
```

### **방법 2: 직접 URL 접근**

브라우저 주소창에 입력:
```
https://chartupndown.com/.netlify/functions/openai-proxy
```

**예상 결과:**
- ✅ **200 OK**: 함수가 정상 배포됨
- ❌ **404 Not Found**: 함수 배포 실패 또는 경로 문제

## 🔧 **문제별 해결방법**

### **🔴 404 오류가 계속 발생하는 경우**

#### **1단계: Netlify 배포 로그 확인**
1. **Netlify 대시보드** → **Deploys**
2. **최신 배포 클릭** → **Deploy log**
3. **"Functions"** 섹션 확인:

```bash
✅ 정상 로그 예시:
Functions bundling                                            
Packaging functions from netlify/functions
✔ openai-proxy: 1.2 KB

❌ 문제 로그 예시:
No functions found in netlify/functions
Functions directory not found
```

#### **2단계: Functions 탭 확인**
1. **Netlify 대시보드** → **Functions**
2. **`openai-proxy` 함수가 목록에 있는지 확인**

❌ **함수가 목록에 없다면**:
- `netlify.toml` 설정 재확인
- 강제 재배포: **Deploys** → **Trigger deploy**

#### **3단계: Build 설정 확인**
**Netlify 대시보드** → **Site settings** → **Build & deploy**:
```
Base directory: (비어있음)
Publish directory: .
Functions directory: netlify/functions
```

### **🟡 200 OK이지만 hasApiKey: false인 경우**

환경변수 설정 필요:

1. **Netlify 대시보드** → **Site settings** → **Environment variables**
2. **Add variable** 클릭:

```
Key: OPENAI_API_KEY
Value: sk-your-openai-api-key
Scopes: All contexts (권장)
```

3. **Deploy** → **Trigger deploy** (재배포 필수!)

### **🟢 모든 테스트가 통과하는 경우**

POST 요청 테스트:

```javascript
fetch('https://chartupndown.com/.netlify/functions/openai-proxy', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    model: 'gpt-4o-mini',
    messages: [{ role: 'user', content: 'test' }],
    max_tokens: 5
  })
}).then(r => r.json()).then(console.log)
```

## 📞 **추가 지원**

문제가 해결되지 않으면:

1. **개발자 도구** 실행 결과 캡처
2. **Netlify 배포 로그** 스크린샷
3. **함수 목록** 스크린샷

---

> 💡 **핵심**: 환경변수 변경 후 반드시 재배포해야 적용됩니다!
